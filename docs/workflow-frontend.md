# workflow-frontend

Данный проект включает в себя все стадии разработки проекта.

Создаем пустой React проект, используя команду `create-react-app workflow-frontend .`

![](../.gitbook/assets/image%20%285%29.png)

![](../.gitbook/assets/image%20%2818%29.png)

Пишем Dockerfile.dev для разворачивания приложения в dev среде. Запускаем `docker build -f` `Dockerfile.dev .` После того как запустили эту команду, начинают скачивать зависимости из package.json. Зависимости ставятся в контейнер и скачиваются в директорию в папку node\_modules. В dev зоне она нам не нужна, можем просто удалить. Контейнер после этого собирается также быстро. 

Можем запустить наш контейнер.

 `docker run -p 3000:3000 ae99c176964c`

![](../.gitbook/assets/image%20%288%29.png)

 Всё работает, но, если мы будем менять наш App.js то эффекта не будет, нужно пересобирать контейнер, т.к. в Dockerfile когда мы делаем COPY делается снепшот текущего состояния файлов. То что мы меняем после не применяется.

![&#x412;&#x43E;&#x442; &#x442;&#x430;&#x43A; &#x44D;&#x442;&#x43E; &#x434;&#x43E;&#x43B;&#x436;&#x43D;&#x43E; &#x440;&#x430;&#x431;&#x43E;&#x442;&#x430;&#x442;&#x44C; &#x441; &#x43F;&#x43E;&#x43C;&#x43E;&#x449;&#x44C;&#x44E; Docker Volume](../.gitbook/assets/image%20%2811%29.png)

![&#x441;&#x43E;&#x437;&#x434;&#x430;&#x435;&#x43C; &#x441;&#x441;&#x44B;&#x43B;&#x43A;&#x438; ](../.gitbook/assets/image%20%2815%29.png)

Если мы не сделаем первый volume и запустим так, то  `docker run -p 3000:3000 -v $(pwd):/app ae99c176964c` вылезет ошибка, тк мы удалили директорию node\_modules и получается так, что ссылки нет.

![](../.gitbook/assets/image%20%281%29.png)

Правильная команда \(т.е. если мы не указываем ничего через ":", то это значит что не стоит искать ссылки на этот объект в локальной директории: `docker run -p 3000:3000 -v /app/node_modules -v $(pwd):/app ae99c176964c` 

Для большего удобства разобьем эту команду и перенесем в `docker-compose.yml` 

![docker-compose.yml](../.gitbook/assets/image%20%2814%29.png)

Теперь чтобы запустить сервис, используем `docker-compose up.`

### Добавляем тесты.

Важной частью разработки ПО является тестирование. Добавляем в наш `docker-compose.yml` файл тесты.

![&#x434;&#x43E;&#x431;&#x430;&#x432;&#x438;&#x43B;&#x438; &#x43F;&#x430;&#x440;&#x430;&#x433;&#x440;&#x430;&#x444; &#x441; &#x442;&#x435;&#x441;&#x442;&#x430;&#x43C;&#x438;](../.gitbook/assets/image%20%2816%29.png)

Теперь после сборки нашего приложения будут запускаться тесты, тк это React - приложение, то тесты у нас хранятся в `src/App.tests.js` . С помощью использования **volumes** мы добились того, что при любом изменении исходного кода приложения тесты будут запускаться **по новому**.

### Необходимость nginx.

![&#x440;&#x430;&#x431;&#x43E;&#x442;&#x430; &#x441;&#x435;&#x440;&#x432;&#x435;&#x440;&#x430; &#x432; Dev &#x441;&#x440;&#x435;&#x434;&#x435;](../.gitbook/assets/image%20%2817%29.png)

![&#x440;&#x430;&#x431;&#x43E;&#x442;&#x430; &#x432; Prod &#x441;&#x440;&#x435;&#x434;&#x435;](../.gitbook/assets/image%20%287%29.png)

![&#x418;&#x441;&#x43F;&#x43E;&#x43B;&#x44C;&#x437;&#x43E;&#x432;&#x430;&#x43D;&#x438;&#x435; nginx ](../.gitbook/assets/image%20%2810%29.png)

Для релиза нашего приложения создадим файл `Dockerfile`.

![](../.gitbook/assets/image%20%2812%29.png)

Собираем наше приложение `docker build .`

После сборки запускаем наш полученный образ `docker run -p 8080:80 <image id>`

**Complete!**

### Travis CI

![](../.gitbook/assets/image%20%282%29.png)

